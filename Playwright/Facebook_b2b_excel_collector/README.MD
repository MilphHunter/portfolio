# üìÇ –û—Å–Ω–æ–≤–Ω—ñ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

---

## üîç –ü–∞—Ä—Å–∏–Ω–≥ Facebook Ads Library
- –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —ñ–Ω–∫–æ–≥–Ω—ñ—Ç–æ-–±—Ä–∞—É–∑–µ—Ä–∞ —á–µ—Ä–µ–∑ **Playwright**
- –ü—Ä–æ–±—Ä–æ—Å cookies —Ä—ñ–∑–Ω–∏—Ö –∞–∫–∞—É–Ω—Ç—ñ–≤
- –ó–º—ñ–Ω–∞ –ø—Ä–æ–∫—Å—ñ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –ø—Ä–æ—Ñ—ñ–ª—é
- –û–±—Ö—ñ–¥ –ø–æ–º–∏–ª–æ–∫, –∫–∞–ø—á—ñ, –∑–∞–≤–∏—Å–∞–Ω—å —ñ –±–ª–æ–∫—É–≤–∞–Ω—å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Å–∫—Ä–æ–ª—ñ–Ω–≥ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ —Ç–∞ –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç—É
- –î–µ—Ç–µ–∫—Ç—É–≤–∞–Ω–Ω—è –æ–∑–Ω–∞–∫ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –∞–±–æ –ø–æ–º–∏–ª–∫–∏ —Å—Ç–æ—Ä—ñ–Ω–∫–∏

---

## üñºÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–µ–¥—ñ–∞ (–∫–∞—Ä—Ç–∏–Ω–∫–∏, –≤—ñ–¥–µ–æ)
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ **aiohttp**
- –ü–æ–≤—Ç–æ—Ä–Ω—ñ —Å–ø—Ä–æ–±–∏, –∑–º—ñ–Ω–∞ –¥–æ–º–µ–Ω—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, Facebook CDN)
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ *Content-Type*
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è (.jpg / .mp4)
- –õ—ñ–º—ñ—Ç –ø–∞—Ä–∞–ª–µ–ª—å–Ω–∏—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å (—Å–µ–º–∞—Ñ–æ—Ä)

---

## üìÅ –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
–î–≤—ñ –±–∞–∑–∏:
- **ads_data.db** ‚Äî —Ä–µ–∞–ª—å–Ω—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è  
- **info_data.db** ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞  

–ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ:
- –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è, –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è, —á–∏—Å—Ç–∫–∞ –±–∞–∑
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è Info-—Ç–∞–±–ª–∏—Ü—å
- –î–µ–¥—É–ø–ª—ñ–∫–∞—Ü—ñ—è —ñ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –Ω–µ—ñ—Å–Ω—É—é—á–∏—Ö —Ñ–∞–π–ª—ñ–≤
- –í–∏–¥–∞–ª–µ–Ω–Ω—è –æ–≥–æ–ª–æ—à–µ–Ω—å –∑–∞ –ø–∞—Ç–µ—Ä–Ω–∞–º–∏ (—á–æ—Ä–Ω–∏–π —Å–ø–∏—Å–æ–∫)

---

## üìä –û–±—Ä–æ–±–∫–∞ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤
- –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑–æ–±—Ä–∞–∂–µ–Ω—å —á–µ—Ä–µ–∑ **pHash**
- –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –≤—ñ–¥–µ–æ:
  - pHash –∫–ª—é—á–æ–≤–∏—Ö –∫–∞–¥—Ä—ñ–≤  
  - SSIM  
- –í–∏–¥–∞–ª–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤ + –∑–∞–ø–∏—Å —É —Ç–∞–±–ª–∏—Ü—é *duplicate_ads*
- –ß–∏—Å—Ç–∫–∞ –ø–∞–ø–∫–∏ *media* –≤—ñ–¥ –∑–∞–π–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤

---

## üìë –†–æ–±–æ—Ç–∞ –∑ Google Sheets
- –ß–∏—Ç–∞–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω—å –∑ Excel —á–µ—Ä–µ–∑ **Google Sheets API**
- –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –∑–∞ –∫–ª—é—á–∞–º–∏
- –û–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –ø—Ä–æ–±–ª–µ–º–Ω–∏—Ö –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
- –§–æ—Ä–º—É–≤–∞–Ω–Ω—è —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É –ø–æ—Å–∏–ª–∞–Ω—å
- –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –≤–∂–µ –≤–∏–∫–æ–Ω–∞–Ω–∏—Ö URL
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è Excel (–¥–∞—Ç–∞ –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥—É)

---

## ‚òÅÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤ —É Backblaze B2
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è MIME-—Ç–∏–ø—É
- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç—ñ–ª—å–∫–∏ –∑–æ–±—Ä–∞–∂–µ–Ω—å/–≤—ñ–¥–µ–æ
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è —Ñ–∞–π–ª—É –ø–µ—Ä–µ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º

---

## üõ°Ô∏è –ó–∞—Ö–∏—Å—Ç —ñ –Ω–∞–¥—ñ–π–Ω—ñ—Å—Ç—å
- –õ–æ–∫-—Ñ–∞–π–ª –∑–∞–ø–æ–±—ñ–≥–∞—î –ø–æ–¥–≤—ñ–π–Ω–∏–º –∑–∞–ø—É—Å–∫–∞–º
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–∞–º‚Äô—è—Ç—ñ
- –ö–æ–Ω—Ç—Ä–æ–ª—å –ø–µ—Ä–µ—Ä–∏–≤–∞–Ω—å
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –∫–ª—é—á–æ–≤–∏—Ö –µ—Ç–∞–ø—ñ–≤
- –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –∑–∞–¥–∞—á —É —á–µ—Ä–≥–∞—Ö

---

# ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω–∏–π —Ü–∏–∫–ª —Ä–æ–±–æ—Ç–∏

MAIN ‚Üí
load settings ‚Üí 
load cookies ‚Üí 
load proxies ‚Üí 
load links from Excel ‚Üí 
filter completed URLs ‚Üí 
split links into batches ‚Üí
for each batch: ‚Üí 
pick next proxy ‚Üí 
rotate cookies ‚Üí
start Playwright page ‚Üí
goto URL ‚Üí 
scroll ‚Üí 
collect ads ‚Üí 
download media ‚Üí 
write ads to DB via writer_coroutine ‚Üí 
write statistics via info_writer_coroutine ‚Üí 
check duplicates (video + image) ‚Üí 
clean DB ‚Üí 
sync Excel ‚Üí 
sync Backblaze ‚Üí
finish



---

## üîë –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Cookies
–§–∞–π–ª cookies.json:

```
{
  "c_user_value": "xs_token",
  "id123": "token123"
}
```

Cookies –æ–±–∏—Ä–∞—é—Ç—å—Å—è –≤–∏–ø–∞–¥–∫–æ–≤–æ ‚Äî –∫–æ–∂–µ–Ω –∑–∞–ø—É—Å–∫ —ñ–¥–µ –ø—ñ–¥ —ñ–Ω—à–∏–º –ø—Ä–æ—Ñ—ñ–ª–µ–º.

## üåê –ü—Ä–æ–∫—Å—ñ
proxy.json:

```
[
  "http://ip:port",
  "http://ip2:port"
]
```

–ö–æ–∂–µ–Ω –ø—Ä–æ–∫—Å—ñ –º–∞—î —Å–≤—ñ–π —Å–µ–º–∞—Ñ–æ—Ä: –º–∞–∫—Å–∏–º—É–º 2 –∑–∞–¥–∞—á—ñ –æ–¥–Ω–æ—á–∞—Å–Ω–æ.

## üìÑ –†–æ–±–æ—Ç–∞ –∑ Excel (Google Sheets)
- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –≤–∏—Ç—è–≥—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ Google Sheets API

- –í–∏–¥–∞–ª—è—é—Ç—å—Å—è –¥—É–±–ª—ñ–∫–∞—Ç–∏

- –û–±‚Äô—î–¥–Ω—É—é—Ç—å—Å—è –ø—Ä–æ–±–ª–µ–º–Ω—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó

- –ì–µ–Ω–µ—Ä—É—é—Ç—å—Å—è URL FB Ads Library

- –§—ñ–ª—å—Ç—Ä—É—é—Ç—å—Å—è –≤–∂–µ –æ–±—Ä–æ–±–ª–µ–Ω—ñ –ª—ñ–Ω–∫–∏

- –ü—ñ—Å–ª—è –ø–∞—Ä—Å–∏–Ω–≥—É –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è –∫–æ–ª–æ–Ω–∫–∞ ‚Äú–û—Å—Ç–∞–Ω–Ω—ñ–π –ü–∞—Ä—Å–∏–Ω–≥‚Äù.

## üé¨ –û–±—Ä–æ–±–∫–∞ –º–µ–¥—ñ–∞
- –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è:
    - pHash

    - SSIM

- –í—ñ–¥–µ–æ:
    - –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ moov-–∞—Ç–æ–º—É

    - –ö–ª—é—á–æ–≤—ñ –∫–∞–¥—Ä–∏ (1, 50, 100)

    - pHash

    - SSIM

- –î—É–±–ª—ñ–∫–∞—Ç–∏:
    - –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è archive_id —É duplicate_ads

    - –í–∏–¥–∞–ª–µ–Ω–Ω—è –∑ ads

    - –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–∞–π–ª—É –∑ –¥–∏—Å–∫—É

## üóÑÔ∏è –†–æ–±–æ—Ç–∞ –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö
- –¢–∞–±–ª–∏—Ü—ñ:

    - ads

    - duplicate_ads

   - info

- –ü—Ä–æ—Ü–µ—Å–∏:

   - writer_coroutine ‚Äî –∑–∞–ø–∏—Å –æ–≥–æ–ª–æ—à–µ–Ω—å

   - info_writer_coroutine ‚Äî –∑–∞–ø–∏—Å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

   - –æ—á–∏—â–µ–Ω–Ω—è ads —Ç–∞ info

   - –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤ –±–µ–∑ —Ñ–∞–π–ª—ñ–≤

   - –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—è IDs

   - –æ–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –±–∞–∑

## üì¶ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —É Backblaze B2
- –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è MIME-—Ç–∏–ø—É

- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —Ñ–∞–π–ª —É–∂–µ —ñ—Å–Ω—É—î

- –ß–∏—Ç–∞–Ω–Ω—è async

- –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —á–µ—Ä–µ–∑ to_thread

## ‚è±Ô∏è –û–±—Ä–æ–±–∫–∞ –±–∞—Ç—á–∞–º–∏

```
batch_size = 3
```
–î–ª—è –∫–æ–∂–Ω–æ–≥–æ –±–∞—Ç—á—É:

- –ü–µ—Ä–µ–º—ñ—à—É–≤–∞–Ω–Ω—è

- –í–∏–±—ñ—Ä –ø—Ä–æ–∫—Å—ñ

- –ó–∞–ø—É—Å–∫ process_task

## üîó process_task

```
process_task ‚Üí
  Playwright ‚Üí
    process_url ‚Üí
      scroll_to_bottom ‚Üí
        download media ‚Üí
          write_queue / info_queue
```
## üõ†Ô∏è –í–∏–Ω—è—Ç–∫–∏ —Ç–∞ –∑–∞—Ö–∏—Å—Ç
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–∞–º‚Äô—è—Ç—ñ —á–µ—Ä–µ–∑ psutil

- –õ–æ–∫-—Ñ–∞–π–ª process.lock

- –õ–æ–≥–∏ parser.log

- –ö–æ—Ä–µ–∫—Ç–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö

## üîç –û–±—Ä–æ–±–∫–∞ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤

```
cv2_duplicates_check ‚Üí
    compare images/videos ‚Üí
        process_duplicates ‚Üí
            remove file
            remove preview
            update DB
```
## üíæ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ñ–∞–π–ª–∞–º–∏
- –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤, —è–∫–∏—Ö –Ω–µ–º–∞—î –≤ –ë–î

- –í–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–ø–∏—Å—ñ–≤ –±–µ–∑ —Ñ–∞–π–ª—ñ–≤

- –í–∏–¥–∞–ª–µ–Ω–Ω—è –ø—Ä–µ–≤‚Äô—é JPG –¥–ª—è MP4

- –û—á–∏—â–µ–Ω–Ω—è info –≤—ñ–¥ –Ω–µ—ñ—Å–Ω—É—é—á–∏—Ö archive_id

## üßπ –§—ñ–Ω–∞–ª—å–Ω–∞ –æ—á–∏—Å—Ç–∫–∞
- –í–∏–¥–∞–ª–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤

- –û—á–∏—â–µ–Ω–Ω—è ads —Ç–∞ info

- –û–±‚Äô—î–¥–Ω–∞–Ω–Ω—è –±–∞–∑

- –û–Ω–æ–≤–ª–µ–Ω–Ω—è Excel

- –í–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–∏–º—á–∞—Å–æ–≤–∏—Ö —Ñ–∞–π–ª—ñ–≤

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫

```
python excel_parser_script.py
```

## üéâ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è
–¶–µ–π —Å–∫—Ä–∏–ø—Ç ‚Äî —Ü–µ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–∞—Ä—Å–µ—Ä, –∞ –ø–æ–≤–Ω–æ—Ü—ñ–Ω–Ω–∞ ETL-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞, —è–∫–∞:

- ‚úî –∑–±–∏—Ä–∞—î –¥–∞–Ω—ñ
- ‚úî –æ—á–∏—â–∞—î
- ‚úî –Ω–æ—Ä–º–∞–ª—ñ–∑—É—î
- ‚úî –≤–∞–ª—ñ–¥–æ–≤—É—î
- ‚úî –∞–Ω–∞–ª—ñ–∑—É—î
- ‚úî –∑–∞–ø–∏—Å—É—î –≤ –±–∞–∑–∏
- ‚úî –æ–Ω–æ–≤–ª—é—î Excel
- ‚úî —Ñ—ñ–ª—å—Ç—Ä—É—î –¥—É–±–ª—ñ–∫–∞—Ç–∏
- ‚úî –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –≤ —Ö–º–∞—Ä—É